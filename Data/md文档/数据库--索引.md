# 数据库--索引

-----

对于数据库索引太多会影响应用程序的性能，但是索引索引太少，对于查询性能又会受到影响。

主要目的：通过了解索引的内部结构来了解哪里可以使用索引。

InnoDB存储引擎支持的索引类型：

- B+树索引
- 全文索引
- 哈希索引

InnoDB存储引擎支持的哈希索引是自适应的，InnoDb存储引擎会自动根据表的使用情况自动为表生成哈希索引，不能人为干预是否在一张表中生成哈希索引。

【注意】：B+树中的B不是二叉树(binary)，而是代表平衡(balance)，因为B+树是从最早的平衡二叉树演化而来的，但是B+树不是一个二叉树。

B+树索引并不能找到给定键值的具体行。B+树索引能找到的只是被查找数据行所在的页。然后通过数据库把页读入到内存，再在内存中进行查找，最后得到要查找的数据。

平衡二叉树的查找性能不是最高的，只是接近最高的性能。

对于平衡二叉树插入，删除操作的时候，需要对这棵树进行左旋或者右旋来达到进行操作之后这个数依旧是一个平衡二叉树。



**B树和B-树同一个，没有所谓的B-树**

B+树，所有记录的结点都是按照顺序放在叶子节点上面的，所有的叶子节点都是通过指针连接起来的，所以要查找一个数据的时候，只需要对于叶子节点进行遍历就可以了。

B树和B+树的区别：

B+树的非叶子结点只具有索引作用而不包含实际的值，所有的叶子节点和相连的结点使用链表相连，便于区间查找和遍历。

B+树的优点：

- 由于B+树的内部结点上不包含数据信息，因此在内存页中能够存放更多的key。数据存放的更加紧密，具有更好的空间局限性。因此访问叶子节点上关联的数据也有更好的缓存命中率
- B+数的叶子节点都是相连的，因此对于整棵树的遍历只需要线性遍历一次叶子节点即可。而且由于数据顺序排列并且相连，所以便于区间查找和搜索。而B树需要进行每一层的递归遍历。相邻的元素可能在内存中不相邻，所以缓存命中性没有B+树好。

B树的优点：

- B树的key和value都是放在一个节点中的，所以访问更加迅速



对于二叉查找树的时间复杂度是O(logN)，其查找效率已经足够高了，那为什么还要B树和B+树的出现呢？

这个是因为磁盘IO的问题。由于磁盘IO的效率很低，那么当在大量数据存储中，查询时我们不能一下子将所有数据加载到内存中，只能逐一加载磁盘页，每一个磁盘页对应一个结点。造成大量磁盘IO操作(最坏的情况为树的高度)。平衡二叉树由于树深度过大而造成磁盘IO读写过于频繁，进而导致效率低下。

所以为了减少磁盘IO的次数，就必须降低树的高度，将“瘦高”的树变得“矮胖”起来。

我们的思想：

- 每一个结点存储多个元素
- 摒弃二叉树结构，采用多叉树

所以就出现了多路查找树，也就是B树和B+树了

B树的特点：

- 根节点至少有两个子女
- 所有的叶子节点必须都位于同一行
- 每个结点中的元素从小到大进行排列，k-1个元素正好是k个孩子结点的元素的值域的划分
- 每个中间节点中都包含k-1个元素和k个孩子
- 每个叶子节点都包含k-1个元素




# 项目：代理服务器

----

## GFW(中国防火长城)

>  GFW即Great Wall of China，中国防火长城，中国政府过滤和监视互联网的一套软硬件系统。作用：用于分析和过滤中国境内外网络间的互相访问。不仅限制中国国内网民访问境外的某些站点，也能限制国外用户访问国内的站点
>
> 被墙：访问被GFW所限制，而“翻墙”，就是突破GFW限制

### GFW的原理

- **DNS污染和劫持**

目前使用访问网站都是通过域名进行访问，而真正访问这个网站需要通过DNS服务器把域名解析为IP地址。而普通的DNS服务使用UDP协议，没有任何的认证机制。DNS挟持是指返回给你一个伪造页面的IP地址，DNS污染就是返回给你一个不存在的页面的IP地址。比如使用的联通，电信的宽带，默认是不需要设置任何DNS服务器的，这些DNS服务器由他们提供，一旦检测到了你访问的网页是不允许访问的，就会返回一个不存在的网页。很多运营商也使用DNS劫持来投放一些广告。

解决办法：

1. 使用Open DNS（208.67.222.222）或Geogle DNS（8.8.8.8）（不太好用被封锁了）
2. 使用一些第三方的DNS服务器
3. 自己用VPS搭建DNS服务器
4. 修改机器host文件，直接IP访问

目的：取不到正常的IP，想办法取到正常的IP地址



- **封锁IP**

通过一些方式，绕过DNS污染和劫持，通过IP地址访问无法访问的网页。目前针对IP进行大范围的封锁。虽然Geogle有很多镜像地址，但是目前基本全部封锁掉，有漏网的可能也坚持不了多久。

采用VPS从国内连接到国外的VPS，进行翻墙。解决方法：

1. 使用VPS搭建代理（Virtual Private Server 虚拟专用服务器 ）
2. 使用IPV6（IPV6地址巨大，采用封地址不现实，但是目前国内只有部分高校部署了IPV6）



- **使用网络命令演示一下上述被墙的过程**

下面可以看到DNS查到geogle ip为31.13.71.23 tracert 31.13.71.23时到219.158.111.245是超时中断。219.158.111.245应该就是GFW的设备机器上的程序检测到了IP源，然后封锁掉了请求

![](C:\Users\0\Pictures\项目\网络代理服务器\nslookup.png)

``` c++
//可以查看ip地址
nslookup www.google.com

//可以看到路由转发到哪里去
tracert 69.171.233.37
```



- **ip备案查询**（ip.chinaz.com）

请求ip地址之后就会发现路由转发数据就会被拦截下来了也就是GFW拦截下来了

最后被拦截下来的是**中国联通骨干网**

也即是转发的时候一定会被拦截下来



- 封锁HTTP代理

使用HTTP代理。客户端不在直接请求目标服务器，而是请求代理服务器，代理服务器再去请求目标服务器，然后返回结果。对于HTTP代理来说，封锁起来非常简单。因为HTTP协议是明文，，

参考《HTTP权威》：代理



- 封锁VPN

虚拟专用网，一种常用于连接中，大型企业或团体与团体之间的私人网络的通讯方法

VPN是客户端使用相应的VPN协议先与VPN服务器进行通信，成功连接后就在操作系统内建立一个虚拟网卡，一般来说默认PC上所有网络通信都从这虚拟网卡上进出，经过VPN服务器中转后在到达目的地·。通常VPN协议会对数据流进行强加密处理，从而使得第三方无法知道数据内容，就是实现了翻墙。



对于VPN和其他的一些加密的传输的协议来说，没有办法直接获取明文的请求信息，所以没有办法直接封锁而是监控

1. 暴力破解
2. 特征检查
   1. 翻墙成功都必须要与对应的远程服务器建立连接，然后在用对应的协议进行数据处理并传输，翻墙工具和远程服务器建立连接时，表现独特，在一大堆流量里很显眼，就会轻易被GFW检测出来
3. 流量监控
4. 深度包检测



- Socks代理

是一种网络传输协议，主要用于客户端与外网服务器

明文传输



服务器部署到哪里：部署到本地上，局域网





## 用的东西：

socks5协议，继承，多态，epoll



## 学习时间::第一部分::105:33









## 问题

请求百度请求的同一个服务器吗？

不一定，要让不同的人访问不同的服务器。（负载均衡）
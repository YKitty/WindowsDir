# 深入理解计算机系统

-----

# 第一章

-----

## 1. 信息就是位+上下文

源程序就是一个由值0和1组成的位序列(比特序列)，8位被组织成一组，称为字节。每个字节表示程序中的某些文本字符。

一般经常使用的是ASCII标准来表示文本字符。即使用一个字节唯一的大小的整数值表示每个字符。

### 上下文

上下文就是对于一个程序来说，这个程序要运行的话，所需要的外部变量的值的集合，叫做上下文

### 信息

系统中所有的信息：磁盘文件，内存中的程序，内存中的用户数据以及网络中传输的数据。这些数据都是由一串比特表示的

区分不同的数据对象的唯一方法就是读取这些数据对象的上下文

## 2. 程序被其他程序翻译成不同的格式

对于一个源程序都必须要经过其他的程序转化成一系列的**低级机器语言指令**。然后这些指令按照一种可执行目标程序的格式打好包，并以二进制磁盘文件的形式存放起来。目标程序也称为**可执行的目标文件**。

对于Unix系统，将**源文件转换为目标文件是由编译器驱动程序**来执行的

**编译系统：预处理器，编译器，汇编器，链接器**

预处理阶段：hello.c->hello.i。进行的是头文件的引入，注释以及宏的替换。

编译阶段：hello.i->hello.s。并且在编译阶段有着一个汇编语言程序。该程序让编译器对于不同的高级语言可以输出同一种汇编语言

汇编阶段：hello.s->hello.o。将hello.s翻译成机器语言指令，并将结果打包成一种可重定目标程序的格式，并将结果存放在hello.o文件中。hello.o是二进制文件。

链接阶段：因为对于hello程序调用了printf函数，该函数存在于一个名为printf.o的目标文件中，而这个文件必须合并到hello.o程序中，而链接器负责的就是合并的工作，结果得到hello文件，他是一个可执行的目标文件，可以被加载到内存中，由系统执行。

## 3. 了解编译系统如何工作是大有益处的

- 优化程序性能。比如：为什么将循环求和的结果存放到一个本地变量要比存放到一个通过引用传递过来的参数中，运行起来快得多的呢？一个函数的开销有多大呢？
- 理解链接是的错误
- 避免安全漏洞。缓存区溢出

## 4. 处理器读并解释存放在内存中的指令

此时，hello.c源程序已经被编译系统翻译成可执行目标文件hello，并被存放在磁盘上。

要想在Unix系统下运行该可执行文件，我们要将文件名输入到称为shell的应用程序上。

shell是一个命令行解释器，输出一个提示符，等待输入一个命令行，然后执行这个命令。如果第一个单词不是内置命令的话，shell就会认为这是一个可执行文件的名字，就将加载并运行这个文件

### 1. 系统的硬件组成

#### 1. 总线

贯穿整个系统的是一组电子管道，称作总线。他携带信息字节并负责在各个部件间传递。

#### 2. I/O设备

**I/O设备时系统与外部世界的联系通道。每个I/O设备都通过一个控制器或者适配器与I/O总线相连。**

控制器与适配器的区别：

- 控制器：I/O设备本身或者系统的主印制电路板上的芯片组。
- 适配器：一块插在主板插槽上的卡。

他们都是在I/O总线以及I/O设备之间传递信息。

#### 3. 主存

就是内存。一个临时存储设备，在处理器执行程序时，用来存放程序和程序处理数据。

#### 4. 处理器

中央处理单元(CPU)，简称处理器，是解释存储在主存中指令的引擎。处理器的核心是一个大小为一个字的存储设备(寄存器)，也成为程序计数器(PC)。

寄存器文件和算术/逻辑单元(ALU)：

寄存器文件就是一个小的存储设备，由一些单个字长的寄存器组成，每个寄存器都有自己的名字。

字长：对于32位机是4字节，对于64位机是8字节

ALU：可能执行的操作：加载，存储，操作，跳转

- 加载：从主存复制一个字或者一个字节到寄存器，以覆盖寄存器原来的内容
- 存储：从寄存器复制一个字或者一个字节到主存的某个位置，以覆盖这个位置上原来的内容
- 操作：把两个寄存器的内容赋值到ALU，ALU对这个两个字做算术运算，并将结果存放到一个寄存器中
- 跳转：从指令本身抽取一个字，并将这个字赋值到程序计数器(PC)中，以覆盖PC中原来的值

### 2. 运行hello程序

初始时，我们在键盘输入一个'./hello'后，shell程序将字符逐一读入到寄存器，再把它放到内存中

当我们在键盘上敲下回车之后，shell知道我们输入完毕了，shell执行一系列指令将hello目标文件中的代码和数据从磁盘赋值到主存。

一旦目标文件hello文件中的代码和数据被加载到主存，处理器就开始执行hello程序的main程序中的机器语言指令，这些指令将“hello world\n”字符串中的字节从主存复制到寄存器文件，在从寄存器文件中复制到显示设备，最终显示在屏幕上。



